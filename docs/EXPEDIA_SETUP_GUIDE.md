# 🌍 מדריך הגדרת Expedia - מערכת DIAM

## סקירה כללית

מערכת DIAM תומכת כעת בסנכרון מלא עם **Expedia Partner Central** בנוסף ל-Booking.com. המדריך הזה יעזור לך להגדיר את הסנכרון בצורה מושלמת.

---

## 🎯 **מה זה נותן לך?**

### ✅ **יתרונות הסנכרון עם Expedia:**
- **ייבוא אוטומטי** של הזמנות מ-Expedia למערכת DIAM
- **ייצוא אוטומטי** של זמינות מ-DIAM ל-Expedia (למניעת הזמנות כפולות)
- **הגנה חכמה** על עריכות ידניות - הזמנות שערכת לא יימחקו
- **סנכרון רקע** אוטומטי כל 30 דקות
- **ממשק משתמש מותאם** לניהול נפרד של Booking.com ו-Expedia

### 🔄 **איך זה עובד?**
1. **Expedia → DIAM**: הזמנות חדשות מ-Expedia מתווספות אוטומטית למערכת
2. **DIAM → Expedia**: כל הזמנה במערכת (ידנית או מבוקינג) חוסמת את התאריכים ב-Expedia
3. **הגנה חכמה**: אם ערכת הזמנה מ-Expedia (מחיר, פרטים, הערות) - היא לא תימחק גם אם בוטלה ב-Expedia

---

## 🚀 **שלב 1: קבלת קישורי iCal מ-Expedia**

### 📍 **איפה למצוא את הקישורים ב-Expedia Partner Central:**

1. **התחבר ל-Expedia Partner Central**:
   - כנס ל: https://www.expediapartnercentral.com/
   - התחבר עם הפרטים שלך

2. **נווט לקישורי iCal**:
   - לך ל **"Property"** → **"Calendar & Rates"**
   - חפש **"Calendar Import/Export"** או **"iCal Integration"**
   - או חפש **"External Calendar"** בתפריט

3. **העתק את הקישורים**:
   - **קישור ייבוא**: זה הקישור שמייצא את הזמינות שלך מ-DIAM ל-Expedia
   - **קישור ייצוא**: זה הקישור שמייבא הזמנות מ-Expedia ל-DIAM

### 🔍 **איך נראים הקישורים?**
```
קישור ייבוא (מ-DIAM ל-Expedia):
https://diam-loy6.onrender.com/api/ical/export/airport/101

קישור ייצוא (מ-Expedia ל-DIAM):
https://calendar.expediapartnercentral.com/ical/[PROPERTY_ID]/[ROOM_ID]/[SECRET_KEY]
```

---

## 🛠️ **שלב 2: הגדרה במערכת DIAM**

### 1. **כניסה לממשק הניהול**
- התחבר למערכת DIAM
- לך ל **"הגדרות"** → **"סנכרון iCal"**

### 2. **בחירת מיקום ופלטפורמה**
- בחר את המיקום: **Airport** או **Rothschild**
- בחר בטאב **🌍 Expedia** (לא Booking.com)

### 3. **הגדרת חדרים**
לכל חדר שברצונך לסנכרן:

#### ✅ **הפעלת החדר**:
- הדלק את המתג **"פעיל ב-Expedia"**

#### 🔗 **הזנת קישור iCal**:
- הדבק את קישור הייצוא מ-Expedia בשדה **"קישור iCal מ-Expedia"**
- הקישור אמור להתחיל ב: `https://calendar.expediapartnercentral.com/...`

#### 🧪 **בדיקת הקישור**:
- לחץ על כפתור **"בדוק קישור"**
- המערכת תבדוק שהקישור תקין ותציג מידע על ההזמנות

### 4. **שמירת ההגדרות**
- לחץ **"שמור הגדרות"**
- המערכת תשמור את כל ההגדרות

---

## ⚡ **שלב 3: סנכרון ראשוני**

### 🔄 **סנכרון ידני ראשון**
1. לחץ על כפתור **🌍** ליד החדר לסנכרון חדר בודד
2. או לחץ **"סנכרן כל החדרים (Expedia)"** לסנכרון מלא
3. המערכת תייבא את כל ההזמנות הקיימות מ-Expedia

### 📊 **בדיקת התוצאות**
- בדוק שההזמנות מ-Expedia הופיעו ברשימת ההזמנות
- כל הזמנה מ-Expedia תסומן עם **🌍 Expedia** במקור
- בדוק שהסטטוס הוא **"הצלחה"** וזמן הסנכרון מעודכן

---

## 🔧 **שלב 4: הגדרת סנכרון אוטומטי**

### ⚙️ **הגדרות כלליות**
1. הדלק **"סנכרון אוטומטי כל שעתיים"**
2. קבע **מרווח זמן**: 30-120 דקות (מומלץ: 60 דקות)
3. הגדר **כתובת מייל להתראות** (אופציונלי)

### 🔔 **הגדרת התראות**
- **התראה על הזמנות חדשות מ-Expedia**: מומלץ להדליק
- **התראה על שגיאות סנכרון**: מומלץ להדליק

---

## 📋 **שלב 5: העתקת קישור הייצוא ל-Expedia**

### 🔗 **קישור הייצוא (מ-DIAM ל-Expedia)**
1. במערכת DIAM, לחץ על **"צפה בקישור ייצוא"** ליד החדר
2. העתק את הקישור שמופיע (למשל):
   ```
   https://diam-loy6.onrender.com/api/ical/export/airport/101
   ```

### 📤 **הזנה ב-Expedia Partner Central**
1. חזור ל-Expedia Partner Central
2. לך ל **"Calendar Import/Export"**
3. הדבק את הקישור בשדה **"Import Calendar URL"**
4. שמור את ההגדרות

---

## ✅ **אימות שהכל עובד**

### 🧪 **בדיקות שכדאי לעשות:**

#### 1. **בדיקת ייבוא מ-Expedia**
- צור הזמנה ב-Expedia Partner Central (או חכה להזמנה אמיתית)
- רענן את מערכת DIAM או חכה לסנכרון אוטומטי
- ודא שההזמנה הופיעה במערכת עם סימון **🌍 Expedia**

#### 2. **בדיקת ייצוא ל-Expedia**
- צור הזמנה ידנית במערכת DIAM
- בדוק ב-Expedia Partner Central שהתאריכים נחסמו
- זה יכול לקחת עד שעה עד שהעדכון יופיע ב-Expedia

#### 3. **בדיקת הגנה על עריכות**
- ערוך הזמנה שהגיעה מ-Expedia (שנה מחיר או הוסף הערה)
- בטל את ההזמנה ב-Expedia Partner Central
- ודא שההזמנה נשארת במערכת DIAM (לא נמחקה)

---

## 🎛️ **ניהול יומיומי**

### 📊 **מסך הניהול**
- בחר **🌍 Expedia** בטאבים כדי לראות רק נתוני Expedia
- הסטטוס של כל חדר מוצג בנפרד לכל פלטפורמה
- זמן הסנכרון האחרון מוצג לכל פלטפורמה בנפרד

### 🔄 **סנכרון ידני**
- לחץ על **🌍** ליד חדר ספציפי לסנכרון מיידי
- לחץ **"סנכרן כל החדרים (Expedia)"** לסנכרון מלא

### 📈 **מעקב ביצועים**
- בדוק את מספר ההזמנות שיובאו מ-Expedia
- עקוב אחר שגיאות סנכרון ותקן אותן מיידית
- וודא שהסנכרון האוטומטי פועל כראוי

---

## 🚨 **פתרון בעיות נפוצות**

### ❌ **שגיאה: "הקישור לא תקין"**
**פתרון:**
1. ודא שהעתקת את הקישור המלא מ-Expedia
2. בדוק שהקישור מתחיל ב: `https://calendar.expediapartnercentral.com/`
3. ודא שלא נוספו רווחים או תווים מיותרים
4. נסה להיכנס לקישור בדפדפן - אמור להוריד קובץ `.ics`

### ⏰ **שגיאה: "Timeout" או "איטי מדי"**
**פתרון:**
1. Expedia יכולה להיות יותר איטית מ-Booking.com - זה נורמלי
2. נסה שוב בעוד כמה דקות
3. אם הבעיה חוזרת, בדוק את החיבור לאינטרנט

### 🔄 **הסנכרון לא עובד**
**פתרון:**
1. ודא שהמתג **"פעיל ב-Expedia"** דלוק
2. ודא שיש קישור iCal תקין
3. בדוק שהסנכרון האוטומטי מופעל בהגדרות הכלליות
4. נסה סנכרון ידני ובדוק הודעות שגיאה

### 📅 **הזמנות לא מופיעות**
**פתרון:**
1. Expedia עשויה לעדכן את לוח השנה כל מספר שעות (לא מיידי כמו Booking.com)
2. ודא שההזמנה אושרה ב-Expedia Partner Central
3. נסה סנכרון ידני אחרי כמה שעות

---

## 🔒 **אבטחה וגיבויים**

### 🛡️ **הגנה על נתונים**
- כל הקישורים מוצפנים ומאובטחים
- המערכת שומרת גיבוי אוטומטי של כל ההגדרות
- הזמנות שנערכו ידנית מוגנות מפני מחיקה

### 💾 **גיבוי הגדרות**
- כל ההגדרות נשמרות אוטומטי במסד הנתונים
- בדוק מדי פעם שהקישורים עדיין תקינים
- שמור עותק של הקישורים במקום בטוח

---

## 📞 **תמיכה וצור קשר**

### 🆘 **אם נתקעת**
1. בדוק את הודעות השגיאה במערכת
2. נסה את הפתרונות המוצעים למעלה
3. צור קשר לתמיכה עם:
   - צילום מסך של השגיאה
   - פרטי החדר והמיקום
   - זמן התקלה

### 📚 **מדריכים נוספים**
- [מדריך Booking.com](./ICAL_BOOKING_SYNC_GUIDE.md)
- [מדריך כללי iCal](./ICAL_ROTHSCHILD_SETUP.md)
- [מדריך פתרון בעיות](./troubleshooting.md)

---

## ✨ **סיכום**

אחרי ההגדרה המלאה, המערכת תסנכרן אוטומטית עם **שתי הפלטפורמות**:
- **🔵 Booking.com**: סנכרון מהיר כל 30 דקות
- **🌍 Expedia**: סנכרון יציב כל שעה-שעתיים

כל פלטפורמה מנוהלת בנפרד, עם הגנה מלאה על עריכות ידניות ומעקב מפורט אחר הביצועים.

**המערכת מוכנה לעבודה! 🎉**

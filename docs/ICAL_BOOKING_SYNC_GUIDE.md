# 🔄 מדריך סנכרון iCal עם Booking.com

## 📋 סקירה כללית

מערכת DIAM כוללת עכשיו מערכת סנכרון מלאה עם Booking.com באמצעות פרוטוקול iCal. המערכת מאפשרת:

- **ייצוא זמינות** מהמערכת שלך לבוקינג
- **ייבוא הזמנות** מבוקינג למערכת שלך
- **סנכרון אוטומטי** כל שעתיים
- **התראות מייל** על הזמנות חדשות ושגיאות

---

## 🚀 התקנה והפעלה

### שלב 1: הפעלת השרת
```bash
cd server
npm install
npm start
```

### שלב 2: גישה לממשק הגדרות
נכנס לממשק הניהול → הגדרות → סנכרון בוקינג (iCal)

---

## ⚙️ הגדרת הסנכרון

### שלב 1: הגדרות כלליות
1. **הפעל סנכרון אוטומטי** - סנכרון כל שעתיים
2. **הזן כתובת מייל** להתראות
3. **שמור הגדרות**

### שלב 2: הגדרת חדרים
לכל חדר:
1. **הפעל את החדר** (מתג פעיל/לא פעיל)
2. **הזן קישור iCal מבוקינג** (לייבוא הזמנות)
3. **העתק קישור ייצוא** לבוקינג (לייצוא זמינות)

---

## 🔗 קישורי iCal

### ייצוא מהמערכת לבוקינג:
```
https://yourdomain.com/api/ical/export/airport/101
https://yourdomain.com/api/ical/export/rothschild/201
```

### ייבוא מבוקינג למערכת:
קישור שתקבל מבוקינג בפורמט:
```
https://admin.booking.com/hotel/hoteladmin/extranet_ng/manage/calendar.html?...
```

---

## 📱 איך להשיג קישורי iCal מבוקינג

### שלב 1: התחברות לבוקינג
1. כנס ל-Booking.com Extranet
2. התחבר עם הפרטים שלך

### שלב 2: מציאת הקישור
1. לך ל: **Calendar** → **Sync Calendars**
2. בחר את החדר הרצוי
3. העתק את הקישור ב-**"Export Calendar"**

### שלב 3: הדבקה במערכת
1. חזור למערכת DIAM
2. הדבק את הקישור בשדה **"קישור iCal מבוקינג"**
3. שמור

---

## 🔄 איך הסנכרון עובד

### ייצוא זמינות (מהמערכת לבוקינג):
1. המערכת יוצרת קובץ iCal עם כל ההזמנות החסומות
2. בוקינג קורא את הקובץ כל שעה
3. בוקינג חוסם תאריכים שתפוסים במערכת שלך

### ייבוא הזמנות (מבוקינג למערכת):
1. המערכת מורידה את קובץ iCal מבוקינג כל שעתיים
2. המערכת מזהה הזמנות חדשות
3. המערכת יוצרת הזמנות חדשות עם סטטוס "מבוקינג"
4. נשלחת התראה מייל על הזמנות חדשות

---

## 📊 מעקב וניטור

### סטטוסי סנכרון:
- **🟢 הצליח** - הסנכרון האחרון עבר בהצלחה
- **🔴 שגיאה** - יש בעיה שצריכה תיקון
- **🟡 בתהליך** - הסנכרון רץ כרגע
- **⚫ מעולם לא** - עדיין לא היה סנכרון

### מידע מועיל:
- **זמן סנכרון אחרון**
- **מספר הזמנות שיובאו**
- **הודעות שגיאה** (אם יש)

---

## 🛠️ פתרון בעיות נפוצות

### בעיה: "הקישור לא תקין"
**פתרון:**
1. בדוק שהקישור מתחיל ב-https://
2. בדוק שהקישור מבוקינג ולא פג תוקף
3. השתמש בכפתור **"בדוק קישור"** לוודא

### בעיה: "לא מקבל הזמנות מבוקינג"
**פתרון:**
1. ודא שהחדר מופעל (מתג פעיל)
2. ודא שהקישור מבוקינג נכון
3. בדוק שהסנכרון האוטומטי מופעל
4. נסה סנכרון ידני

### בעיה: "בוקינג לא רואה זמינות"
**פתרון:**
1. העתק את קישור הייצוא מהמערכת
2. הדבק אותו בבוקינג ב-"Import Calendar"
3. המתן עד שעה לעדכון בבוקינג

---

## 📧 התראות מייל

המערכת שולחת התראות על:
- **הזמנות חדשות** מבוקינג
- **שגיאות סנכרון**
- **סיכום סנכרון יומי**

### הגדרת התראות:
1. הזן כתובת מייל בהגדרות כלליות
2. בחר אילו התראות לקבל
3. שמור הגדרות

---

## 🕐 לוח זמנים אוטומטי

### סנכרון רגיל:
- **כל שעתיים** - ייבוא הזמנות מבוקינג
- **רק חדרים מופעלים** עם קישור תקין

### סנכרון יומי:
- **כל יום בשעה 6:00** - סנכרון מקיף של כל החדרים
- **כולל דו"ח סיכום** במייל

---

## 🔧 פקודות מתקדמות

### סנכרון ידני חדר ספציפי:
```bash
curl -X POST http://localhost:3200/api/ical/sync/airport/101 \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### סנכרון כל חדרי המיקום:
```bash
curl -X POST http://localhost:3200/api/ical/sync/airport \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### בדיקת סטטוס:
```bash
curl http://localhost:3200/api/ical/status/airport \
  -H "Authorization: Bearer YOUR_TOKEN"
```

---

## 📋 רשימת בדיקות

לפני הפעלה:
- [ ] השרת רץ ופעיל
- [ ] יש חיבור לאינטרנט
- [ ] כתובת המייל נכונה
- [ ] קישורי iCal מבוקינג תקינים
- [ ] החדרים מופעלים
- [ ] נבדק סנכרון ידני ראשון

---

## 🆘 תמיכה

במקרה של בעיות:
1. בדוק את הלוגים בקונסול השרת
2. נסה סנכרון ידני
3. בדוק קישורי iCal עם הכפתור המיועד
4. ודא שיש חיבור אינטרנט יציב

---

## 🎯 טיפים למקסום היעילות

1. **בדוק קישורים תקופתית** - קישורי בוקינג עלולים לפוג
2. **עקוב אחרי התראות** - פתור בעיות מיד כשהן מתגלות
3. **סנכרן ידנית לפני עונות עמוסות** - לוודא שהכל עובד
4. **שמור גיבויים** של הגדרות iCal חשובות

---

**✅ המערכת מוכנה לשימוש מלא!** 